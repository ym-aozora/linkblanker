/*! linkblanker 2014-09-07 */
var linkblanker;!function(a){var b=function(){var a,b,c=this;this.manifest=null;var d=function(){e(),chrome.tabs.getAllInWindow(null,function(a){for(var b=0;b<a.length;b++)c.updateStatus(a[b],1)}),chrome.tabs.onUpdated.addListener(function(a,b,d){c.updateStatus(d)}),chrome.extension.onConnect.addListener(function(a){b=a,b.onMessage.addListener(c[a.name])}),f()},e=function(){a={"disabled-extension":Number(localStorage["disabled-extension"]||"0"),"disabled-on":Number(localStorage["disabled-on"]||"0"),"disabled-domain":JSON.parse(localStorage["disabled-domain"]||"[]"),"disabled-directory":JSON.parse(localStorage["disabled-directory"]||"[]"),"disabled-page":JSON.parse(localStorage["disabled-page"]||"[]"),"enabled-background-open":Number(localStorage["enabled-background-open"]||"0"),"enabled-multiclick-close":Number(localStorage["enabled-multiclick-close"]||"0")}},f=function(){var a=chrome.extension.getURL("/manifest.json"),b=new XMLHttpRequest;b.onload=function(){c.manifest=JSON.parse(b.responseText)},b.open("GET",a,!0),b.send(null)};return this.getData=function(){return e(),a},this.updateStatus=function(b,d){var e=c.enableFromUrl(b.url);d=d||0,d||chrome.tabs.sendMessage(b.id,{name:"updateStatus",enable:e,isBackground:1===a["enabled-background-open"]&&0===a["disabled-extension"]?1:0,multiClickClose:1===a["enabled-multiclick-close"]&&0===a["disabled-extension"]?1:0}),chrome.browserAction.setBadgeBackgroundColor({color:e?[0,0,200,128]:[200,0,0,128],tabId:b.id}),chrome.browserAction.setBadgeText({text:e?"RUN":"STOP",tabId:b.id})},this.currentEnable=function(a){a&&c.currentData(function(b){a(c.enableFromFullData(b))})},this.enableFromFullData=function(b){if(e(),b.url.match(/^chrome:\/\/(.*)$/))return 0;var c=0===a["disabled-extension"]&&0===a["disabled-on"]&&-1===a["disabled-domain"].indexOf(b.domain)&&-1==a["disabled-page"].indexOf(b.url);if(c)for(var d=0;d<a["disabled-directory"].length;d++)if(b.url.match(new RegExp("^"+a["disabled-directory"][d]+".*$"))){c=!1;break}return c?1:0},this.enableFromUrl=function(a){return c.enableFromFullData(c.parseData(a))},this.currentData=function(a){a&&chrome.tabs.getSelected(null,function(b){c.parseData(b.url,a)})},this.parseData=function(a,b){a=encodeURI(a);var c={domain:"",directory:"",url:a},d=c.url.split("/");return d&&(d.length>2&&(c.domain=d[2]),d.length>4&&d.splice(d.length-1,1),c.directory=d.join("/")),b&&b(c),c},this.notifyAllTabs=function(){chrome.tabs.getAllInWindow(null,function(a){for(var b=0;b<a.length;b++)linkblanker.updateStatus(a[b])})},this.removeTabs=function(a){chrome.tabs.getAllInWindow(null,function(b){b.sort(function(b,c){return b.index<c.index?"right"===a.align?-1:1:b.index>c.index?"right"===a.align?1:-1:0});for(var c=[],d=-1,e=0;e<b.length;e++)b[e].active?d=b[e].id:d>-1&&c.push(b[e].id);c.length>0&&(chrome.tabs.remove(c),a.name="norifyRemoveTabs",a.removeTabsLength=c.length,chrome.tabs.sendMessage(d,a))})},this.openTab=function(a){a&&chrome.tabs.getSelected(null,function(b){a.index=b.index+1,chrome.tabs.create(a)})},d(),c};a.linkblanker=new b}(this);