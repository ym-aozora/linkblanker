/*! linkblanker 2014-09-07 */
!function(a){var b,c,d,e={},f='<div class="linkblanker-close-action"><div class="linkblanker-message">'+chrome.i18n.getMessage("message_drop_tabs")+'<p class="linkblanker-from">By Link Blanker</p></div></div>',g=function(){h("openTab"),h("removeTabs"),j()},h=function(a){port=chrome.extension.connect({name:a}),delete e[a],port.onDisconnect.addListener(function(){e[a]=!1}),e[a]=port},i=function(b){var c=(Math.floor(document.documentElement.clientWidth/2),Math.floor(b.pageY)-250),d=Math.floor(b.pageX)-250,e=window.scrollY,g=window.scrollX,h={top:e,right:g+document.documentElement.clientWidth,bottom:e+document.documentElement.clientHeight,left:g};c<h.top?c=h.top:c+500>h.bottom&&(c=h.bottom-500),d<h.left?d=h.left:d+500>h.right&&(d=h.right-500),a(f.replace("{REMOVE_TAB_ALIGN}",chrome.i18n.getMessage("left"===b.align?"title_left":"title_right")).replace("{REMOVE_TAB_LENGTH}",b.removeTabsLength)).css({top:c+"px",left:d+"px","background-image":"url('"+chrome.extension.getURL("/images/close-action.png")+"')"}).appendTo(a("body")),setTimeout(function(){a(".linkblanker-close-action").remove()},1100)};chrome.extension.onMessage.addListener(function(a){"name"in a&&("updateStatus"===a.name?("enable"in a&&a.enable?b||(b=!0):b=!1,d="isBackground"in a?a.isBackground:0,"multiClickClose"in a&&a.multiClickClose?c||(c=!0):c=!1,j()):"norifyRemoveTabs"===a.name&&i(a))});var j=function(){b?a("a").off("click",l).on("click",l):a("a").off("click",l),c?a(window).off("click",k).on("click",k):a(window).off("click",k)},k=function(a){var b=a.originalEvent;if(e.removeTabs&&"a"!==b.target.nodeName.toLowerCase()&&3==b.detail){var c=a.clientX>document.documentElement.clientWidth/2?"right":"left";e.removeTabs.postMessage({align:c,clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY});var d=window.getSelection();d.collapse(document.body,0)}},l=function(a){if(e.openTab&&this.href&&!this.onclick&&!this.href.match(/javascript:/i)&&!this.href.match(/#.*$/i)){a.preventDefault(),a.stopPropagation();var b={url:m(this.href),selected:1==d?!1:!0};return e.openTab.postMessage(b),!1}},m=function(a){var b=document.createElement("div");return b.innerHTML='<a href="'+a+'" />',b.firstChild.href};g()}(jQuery);