/*! linkblanker 2014-09-07 */
!function(a){var b=[{id:"disabled-extension",group:0,control:"checkbox",label:chrome.i18n.getMessage("title_pause")},{id:"disabled-off",group:1,control:"radio",value:0,label:chrome.i18n.getMessage("title_disabled_off")},{id:"disabled-on",group:1,control:"radio",value:1,label:chrome.i18n.getMessage("title_disabled_on")},{id:"disabled-domain",group:1,control:"radio",value:2,label:chrome.i18n.getMessage("title_disabled_domain")},{id:"disabled-directory",group:1,control:"radio",value:3,label:chrome.i18n.getMessage("title_disabled_directory")},{id:"disabled-page",group:1,control:"radio",value:4,label:chrome.i18n.getMessage("title_disabled_page")},{id:"enabled-background-open",group:2,control:"checkbox",listClass:"list-split",label:chrome.i18n.getMessage("title_background_open")},{id:"enabled-multiclick-close",group:3,control:"checkbox",label:chrome.i18n.getMessage("title_multiclick_close")}],c=['<h2 class="preference-header">Links</h2>','<ul class="preference-list">','<li><a href="http://www.aozora-create.com/service/linkblanker" title="Link Blanker" target="_blank">'+chrome.i18n.getMessage("title_link_help")+"</a></li>","</ul>"].join(""),d=chrome.extension.getBackgroundPage().linkblanker,e=!0,f=0,g=function(){h()},h=function(){d.currentData(function(d){var e;if(d.url.match(/^chrome:\/\/(.*)$/))return e=['<div id="wrapper">',j(),'<h2 class="preference-header-disabled">'+chrome.i18n.getMessage("message_cannot_use")+"</h2>",c,"</div>"],void a("body").append(e.join(""));for(var f=[],g=[],h=1;h<b.length;h++)switch(b[h].group){case 1:case 2:f.push(k(h));break;case 3:g.push(k(h))}e=['<div id="wrapper">',j(),'<h2 class="preference-header">'+chrome.i18n.getMessage("title_whole_setting")+"</h2>",'<ul class="preference-list">',k(0),"</ul>",'<h2 class="preference-header">'+chrome.i18n.getMessage("title_open_settings")+"</h2>",'<ul class="preference-list">',f.join(""),"</ul>",'<h2 class="preference-header">'+chrome.i18n.getMessage("title_close_settings")+"</h2>",'<ul class="preference-list">',g.join(""),"</ul>",c,"</div>"],a("body").append(e.join("")),a("input[type=checkbox], input[type=radio]").change(n),l()})},j=function(){return['<div id="extension-name"><span id="version-name">Version ',d.manifest.version,"</span></div>"].join("")},k=function(a){return"checkbox"===b[a].control?["<li ",b[a].listClass?'class="'+b[a].listClass+'"':"",'><label data-group="',b[a].group,'"><input id="',b[a].id,'" type="checkbox" data-group="',b[a].group,'" name="',b[a].id,'" /><span>',b[a].label,"</span></label></li>"].join(""):["<li ",b[a].listClass?'class="'+b[a].listClass+'"':"",'><label data-group="',b[a].group,'" data-value="',b[a].value,'"><input id="',b[a].id,'" type="radio" data-group="',b[a].group,'" name="radio-',b[a].group,'" value="',b[a].value,'"/><span>',b[a].label,"</span></label></li>"].join("")},l=function(){a.each(b,function(b,c){var e=a("#"+c.id),f=e.attr("id"),g=e.attr("type");e.removeAttr("checked"),localStorage[f]?"checkbox"===g||"disabled-on"===f?(1==localStorage[f]&&e.attr("checked","checked"),m()):d.currentData(function(a){var b=q(f,a),c=d.getData();if("disabled-directory"===f){for(var g=0;g<c[f].length;g++)if(b.match(new RegExp("^"+c[f][g]+".*$"))){e.attr("checked","checked");break}}else c[f].indexOf(b)>-1&&e.attr("checked","checked");m()}):(c.default&&e.attr("checked","checked"),m())})},m=function(){f++,f==b.length-1&&o()},n=function(){var b=a(this),c=this.id,f=this.type,g=this.value,h=b.is(":checked");"checkbox"===f||"disabled-on"===c?localStorage[c]=h?1:0:g>=2&&d.currentData(function(a){var b=q(c,a),e=d.getData(),f=e[c].indexOf(b);h?-1==f&&e[c].push(b):f>-1&&e[c].splice(f,1),localStorage[c]=JSON.stringify(e[c])}),e&&(o(),d.notifyAllTabs())},o=function(){e=!1,0===a('input[data-group="1"]:checked').size()&&a('input[data-group="1"]:eq(0)').attr("checked","checked");for(var c=a.unique(b.map(function(a){return a.group})).sort(),d=0;d<c.length;d++)p(group[d]);a('input[data-group="1"]').each(function(){a(this).is(":checked")||a(this).trigger("change")}),e=!0},p=function(b){a('input[data-group="'+b+'"]').each(function(){var b=a(this);switch(groups[i]){case 0:b.is(":checked")?a('[data-group="1"], [data-group="2"], [data-group="3"]').attr("disabled","disabled"):a('[data-group="1"], [data-group="2"], [data-group="3"]').removeAttr("disabled");break;case 1:a('input[data-group="0"]').is(":checked")||0!==b.val()||(b.is(":checked")?a('[data-group="2"]').removeAttr("disabled"):a('[data-group="2"]').attr("disabled","disabled"))}b.is(":checked")?b.parents("label").addClass("checked"):b.parents("label").removeClass("checked")})},q=function(a,b){return"disabled-domain"===a?b.domain:"disabled-directory"===a?b.directory:b.url};g()}(jQuery);